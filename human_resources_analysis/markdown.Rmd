---
title: "Analysis of Dental Magic's Human Resources Dataset"
author: "Jennie Eardley"
date: "08/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
library(tidyverse)
library(janitor)
library(plotly)
library(gt)
library(tsibble)
library(anytime)

hr <- read_csv("data/HRDataset_v13.csv") %>% 
  clean_names()
hr <- data.frame(lapply(hr, function(x){
  if (is.character(x)) return(tolower(x))
  else return(x)
}))
hr <- hr %>% 
  mutate_if(is.factor, as.character)
hr <- hr %>% 
  rename(c("date_of_hire" = "dateof_hire", "date_of_termination" = "dateof_termination", "days_late_last_30" = "days_late_last30"))
hr <- hr %>% 
  filter(!is.na(emp_id))
```

**Data Source**

This is a dataset based around a fictional company called Dental Magic, created to teach HR analytics. The dataset is from Kaggle and is available here: https://www.kaggle.com/rhuebner/human-resources-data-set

**Recruitment**
 
```{r}
hr <- hr %>% 
  mutate(date_of_hire = anydate(date_of_hire))
```

```{r}
hr %>%  
  group_by(date_of_hire) %>% 
  summarise(n = n())
```

```{r echo = FALSE}
hr_tsibble <- as_tsibble(hr, key = emp_id, index = date_of_hire)
```
```{r}
 indexed_tsibble <- hr_tsibble %>% 
  index_by(hire_month = ~ yearmonth(.)) %>% 
  summarise(monthly_count = n()) 

ggplot(indexed_tsibble, aes(x = hire_month, y = monthly_count)) +
  geom_line(group = 1) +
  labs(x = "Year",
       y = "Count",
       title =)

```


```{r echo = FALSE}
hr %>% 
  mutate(recruitment_source = fct_rev(recruitment_source)) %>% 
  filter(!is.na(recruitment_source)) %>%
  ggplot() +
  geom_bar(aes(x = recruitment_source)) +
  coord_flip() +
  labs()
```


```{r}
hr %>% 
  filter(!is.na(emp_satisfaction)) %>% 
  ggplot() +
  geom_point(aes(x = emp_satisfaction, y = pay_rate))
```


**Diversity**

```{r echo = FALSE}
 hr %>% 
  filter(!is.na(race_desc)) %>% 
  mutate(race_desc = fct_rev(race_desc)) %>% 
  ggplot() +
  geom_bar(aes(x = race_desc), fill = "dark blue") + 
  coord_flip() +
  labs(x = "Racial Description",
       y = "Count", 
       title = "Racial Breakdown Across the Company")
```
```{r echo = FALSE}
hr %>% 
  mutate(race_desc = fct_rev(race_desc)) %>% 
  filter(from_diversity_job_fair_id == 1) %>% 
  ggplot() + 
  geom_bar(aes(x = race_desc), fill = "dark blue") +
  coord_flip() +
  labs(x = "Racial Description", 
      y = "Count",
      title = "Racial Breakdown from Diversity Job Fair Recruitment")
```
**Employee Satisfaction Levels**


**Staff Turnover**

There are a total of 310 staff records, with 196 currently employed and 11 due to onboard. The rest have all left, the breakdown for their reasons of leaving are as follows:

```{r echo = FALSE}
hr %>% 
  mutate(term_reason = fct_rev(term_reason)) %>% 
  filter(!is.na(term_reason)) %>% 
  filter(term_reason != "n/a - still employed") %>% 
  filter(term_reason != "n/a - has not started yet") %>% 
  ggplot() +
  geom_bar(aes(x = term_reason), fill = "dark blue") +
  coord_flip() +
  labs(x = "Reason",
       y = "Count",
       title = "Reason for Leaving") 
```


